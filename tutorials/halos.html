<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Halos in Pynbody &mdash; pynbody 0.18-alpha documentation</title>
    
    <link rel="stylesheet" href="../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.18-alpha',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="pynbody 0.18-alpha documentation" href="../index.html" />
    <link rel="up" title="Pynbody Tutorials" href="tutorials.html" />
    <link rel="next" title="Batch-processing Snapshots with Pynbody" href="processing.html" />
    <link rel="prev" title="Pictures in Pynbody" href="pictures.html" />
 
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-38063425-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="processing.html" title="Batch-processing Snapshots with Pynbody"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="pictures.html" title="Pictures in Pynbody"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">pynbody 0.18-alpha documentation</a> &raquo;</li>
          <li><a href="tutorials.html" accesskey="U">Pynbody Tutorials</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="halos-in-pynbody">
<span id="halo-tutorial"></span><h1>Halos in Pynbody<a class="headerlink" href="#halos-in-pynbody" title="Permalink to this headline">¶</a></h1>
<p><cite>Pynbody</cite> includes functionality to deal with &#8220;halos&#8221; in
simulations. A <a class="reference internal" href="../convenience.html#pynbody.halo.Halo" title="pynbody.halo.Halo"><tt class="xref py py-class docutils literal"><span class="pre">Halo</span></tt></a> is essentially an object
that holds information about the particle IDs and other properties
about a given halo, and a <a class="reference internal" href="../convenience.html#pynbody.halo.HaloCatalogue" title="pynbody.halo.HaloCatalogue"><tt class="xref py py-class docutils literal"><span class="pre">HaloCatalogue</span></tt></a> is an
object which allows one to easily access the information about all the
halos in a given snapshot.</p>
<p>We currently support halo data from the Amiga Halo Finder (AHF)
(<a class="reference internal" href="../convenience.html#pynbody.halo.AHFCatalogue" title="pynbody.halo.AHFCatalogue"><tt class="xref py py-class docutils literal"><span class="pre">AHFCatalogue</span></tt></a> class), the SKID halo finder
(<a class="reference internal" href="../convenience.html#pynbody.halo.GrpCatalogue" title="pynbody.halo.GrpCatalogue"><tt class="xref py py-class docutils literal"><span class="pre">GrpCatalogue</span></tt></a> class) and the SubFind halo finder
(<a class="reference internal" href="../convenience.html#pynbody.halo.SubfindCatalogue" title="pynbody.halo.SubfindCatalogue"><tt class="xref py py-class docutils literal"><span class="pre">SubfindCatalogue</span></tt></a>). The
<a class="reference internal" href="../essentials.html#pynbody.snapshot.SimSnap" title="pynbody.snapshot.SimSnap"><tt class="xref py py-class docutils literal"><span class="pre">SimSnap</span></tt></a> class provides a convenience
function <a class="reference internal" href="../essentials.html#pynbody.snapshot.SimSnap.halos" title="pynbody.snapshot.SimSnap.halos"><tt class="xref py py-func docutils literal"><span class="pre">halos()</span></tt></a>, which tries to
automatically determine whether halo data for the given output exists
on disk already, and if so attempts to load the appropriate halo
catalogue.</p>
<p>This tutorial will try to demonstrate some of the basic functionality
of the halo catalogue implementation. If you are not familiar with
<cite>Pynbody</cite> in general, it is recommended that you first have a look at
the <a class="reference internal" href="snapshot_manipulation.html#snapshot-manipulation"><em>Basic snapshot manipulation</em></a> tutorial.</p>
<div class="section" id="working-with-halos-and-catalogues">
<h2>Working with Halos and Catalogues<a class="headerlink" href="#working-with-halos-and-catalogues" title="Permalink to this headline">¶</a></h2>
<p>We will use the AHF catalogue here since that is the one that is
available for the sample output in the <cite>testdata</cite> bundle.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [1]: </span><span class="kn">import</span> <span class="nn">pynbody</span><span class="o">,</span> <span class="nn">matplotlib.pylab</span> <span class="kn">as</span> <span class="nn">plt</span>

<span class="gp">In [2]: </span><span class="n">s</span> <span class="o">=</span> <span class="n">pynbody</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s">&#39;testdata/g15784.lr.01024.gz&#39;</span><span class="p">)</span>
<span class="go">---------------------------------------------------------------------------</span>
<span class="go">IOError                                   Traceback (most recent call last)</span>
<span class="go">&lt;ipython-input-2-938a4c194ada&gt; in &lt;module&gt;()</span>
<span class="go">----&gt; 1 s = pynbody.load(&#39;testdata/g15784.lr.01024.gz&#39;)</span>

<span class="go">/home/ics/roskar/python/pynbody/__init__.pyc in load(filename, *args, **kwargs)</span>
<span class="go">    231             return c(filename,*args,**kwargs)</span>
<span class="go">    232 </span>
<span class="go">--&gt; 233     raise IOError(&quot;File %r: format not understood or does not exist&quot;%filename)</span>
<span class="go">    234 </span>
<span class="go">    235 </span>

<span class="go">IOError: File &#39;testdata/g15784.lr.01024.gz&#39;: format not understood or does not exist</span>

<span class="gp">In [3]: </span><span class="n">s</span><span class="o">.</span><span class="n">physical_units</span><span class="p">()</span>
<span class="go">---------------------------------------------------------------------------</span>
<span class="go">NameError                                 Traceback (most recent call last)</span>
<span class="go">&lt;ipython-input-3-48d4b86f3d5b&gt; in &lt;module&gt;()</span>
<span class="go">----&gt; 1 s.physical_units()</span>

<span class="go">NameError: name &#39;s&#39; is not defined</span>
</pre></div>
</div>
<p>We&#8217;ve got the snapshot loaded, now we ask <cite>Pynbody</cite> to load any
available halo catalogue:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [4]: </span><span class="n">h</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">halos</span><span class="p">()</span>
<span class="go">---------------------------------------------------------------------------</span>
<span class="go">NameError                                 Traceback (most recent call last)</span>
<span class="go">&lt;ipython-input-4-dd000090d028&gt; in &lt;module&gt;()</span>
<span class="go">----&gt; 1 h = s.halos()</span>

<span class="go">NameError: name &#39;s&#39; is not defined</span>
</pre></div>
</div>
<p><cite>h</cite> is now the AHF halo catalogue. We can easily retrieve some basic
information, like the total number of halos in this catalogue:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [5]: </span><span class="nb">len</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
<span class="go">---------------------------------------------------------------------------</span>
<span class="go">NameError                                 Traceback (most recent call last)</span>
<span class="go">&lt;ipython-input-5-d19b49735224&gt; in &lt;module&gt;()</span>
<span class="go">----&gt; 1 len(h)</span>

<span class="go">NameError: name &#39;h&#39; is not defined</span>
</pre></div>
</div>
<p>The catalogue has halos ordered by number of particles, so the first
halo for this zoom simulation will be the one we would most likely be
interested in. So lets see some of its stats:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [6]: </span><span class="n">h</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">properties</span>
<span class="go">---------------------------------------------------------------------------</span>
<span class="go">NameError                                 Traceback (most recent call last)</span>
<span class="go">&lt;ipython-input-6-9cb032990344&gt; in &lt;module&gt;()</span>
<span class="go">----&gt; 1 h[1].properties</span>

<span class="go">NameError: name &#39;h&#39; is not defined</span>
</pre></div>
</div>
<p>These are just a dictionary, e.g.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [7]: </span><span class="n">h</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="s">&#39;children&#39;</span><span class="p">]</span>
<span class="go">---------------------------------------------------------------------------</span>
<span class="go">NameError                                 Traceback (most recent call last)</span>
<span class="go">&lt;ipython-input-7-ea18632dffaa&gt; in &lt;module&gt;()</span>
<span class="go">----&gt; 1 h[1].properties[&#39;children&#39;]</span>

<span class="go">NameError: name &#39;h&#39; is not defined</span>
</pre></div>
</div>
<p>returns a list of sub-halos of this halo.</p>
<p>Here, we access individual halos simply by indexing the halo
catalogue. For the <a class="reference internal" href="../convenience.html#pynbody.halo.AHFCatalogue" title="pynbody.halo.AHFCatalogue"><tt class="xref py py-class docutils literal"><span class="pre">AHFCatalogue</span></tt></a>, the
<cite>properties</cite> attribute returns the familiar halo parameters usually
stored in the AHF <cite>.stat</cite> file. For example, to compare masses of the two halos with the most particles in this catalogue,</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [8]: </span><span class="nb">len</span><span class="p">(</span><span class="n">h</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">len</span><span class="p">(</span><span class="n">h</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="go">---------------------------------------------------------------------------</span>
<span class="go">NameError                                 Traceback (most recent call last)</span>
<span class="go">&lt;ipython-input-8-9f89c5b4cb54&gt; in &lt;module&gt;()</span>
<span class="go">----&gt; 1 len(h[1]), len(h[2])</span>

<span class="go">NameError: name &#39;h&#39; is not defined</span>
</pre></div>
</div>
<p>As is already evident above, &#8220;halos&#8221; here are no different than simple
Pynbody <a class="reference internal" href="../essentials.html#pynbody.snapshot.SubSnap" title="pynbody.snapshot.SubSnap"><tt class="xref py py-class docutils literal"><span class="pre">SubSnap</span></tt></a> that we are already
familiar with. It therefore understands the usual interface used for
any other <a class="reference internal" href="../essentials.html#pynbody.snapshot.SimSnap" title="pynbody.snapshot.SimSnap"><tt class="xref py py-class docutils literal"><span class="pre">SimSnap</span></tt></a> object. For example:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [9]: </span><span class="n">h1</span> <span class="o">=</span> <span class="n">h</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="go">---------------------------------------------------------------------------</span>
<span class="go">NameError                                 Traceback (most recent call last)</span>
<span class="go">&lt;ipython-input-9-530e536cd564&gt; in &lt;module&gt;()</span>
<span class="go">----&gt; 1 h1 = h[1]</span>

<span class="go">NameError: name &#39;h&#39; is not defined</span>

<span class="gp">In [10]: </span><span class="n">h1</span><span class="p">[</span><span class="s">&#39;mass&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">in_units</span><span class="p">(</span><span class="s">&#39;1e12 Msol&#39;</span><span class="p">)</span>
<span class="go">---------------------------------------------------------------------------</span>
<span class="go">NameError                                 Traceback (most recent call last)</span>
<span class="go">&lt;ipython-input-10-382f6f334fa7&gt; in &lt;module&gt;()</span>
<span class="go">----&gt; 1 h1[&#39;mass&#39;].sum().in_units(&#39;1e12 Msol&#39;)</span>

<span class="go">NameError: name &#39;h1&#39; is not defined</span>

<span class="gp">In [11]: </span><span class="n">h1</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="go">---------------------------------------------------------------------------</span>
<span class="go">NameError                                 Traceback (most recent call last)</span>
<span class="go">&lt;ipython-input-11-633734839b3a&gt; in &lt;module&gt;()</span>
<span class="go">----&gt; 1 h1.keys()</span>

<span class="go">NameError: name &#39;h1&#39; is not defined</span>

<span class="gp">In [12]: </span><span class="n">h1</span><span class="o">.</span><span class="n">derivable_keys</span><span class="p">()[:</span><span class="mi">10</span><span class="p">]</span> <span class="c"># just showing the first 10</span>
<span class="go">---------------------------------------------------------------------------</span>
<span class="go">NameError                                 Traceback (most recent call last)</span>
<span class="go">&lt;ipython-input-12-f15549b945e4&gt; in &lt;module&gt;()</span>
<span class="go">----&gt; 1 h1.derivable_keys()[:10] # just showing the first 10</span>

<span class="go">NameError: name &#39;h1&#39; is not defined</span>
</pre></div>
</div>
<p>A really common use-case is that one wants to center the simulation on
a given halo and analyze some of its properties. Since halos are just
<a class="reference internal" href="../essentials.html#pynbody.snapshot.SubSnap" title="pynbody.snapshot.SubSnap"><tt class="xref py py-class docutils literal"><span class="pre">SubSnap</span></tt></a> objects, this is easy to do:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [13]: </span><span class="n">pynbody</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">halo</span><span class="o">.</span><span class="n">center</span><span class="p">(</span><span class="n">h1</span><span class="p">)</span>
<span class="go">---------------------------------------------------------------------------</span>
<span class="go">NameError                                 Traceback (most recent call last)</span>
<span class="go">&lt;ipython-input-13-1b5575acd77e&gt; in &lt;module&gt;()</span>
<span class="go">----&gt; 1 pynbody.analysis.halo.center(h1)</span>

<span class="go">NameError: name &#39;h1&#39; is not defined</span>

<span class="gp">In [14]: </span><span class="n">im</span> <span class="o">=</span> <span class="n">pynbody</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">image</span><span class="p">(</span><span class="n">h1</span><span class="o">.</span><span class="n">d</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="s">&#39;500 kpc&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Greys</span><span class="p">,</span> <span class="n">units</span> <span class="o">=</span> <span class="s">&#39;Msol kpc^-2&#39;</span><span class="p">)</span>
<span class="go">---------------------------------------------------------------------------</span>
<span class="go">NameError                                 Traceback (most recent call last)</span>
<span class="go">&lt;ipython-input-14-6cf8b69cc538&gt; in &lt;module&gt;()</span>
<span class="go">----&gt; 1 im = pynbody.plot.image(h1.d, width = &#39;500 kpc&#39;, cmap=plt.cm.Greys, units = &#39;Msol kpc^-2&#39;)</span>

<span class="go">NameError: name &#39;h1&#39; is not defined</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/halo1_image.png"><img alt="../_images/halo1_image.png" src="../_images/halo1_image.png" style="width: 5in;" /></a>
</div>
<div class="section" id="partial-loading-the-halos-versus-full-load">
<h2>Partial loading the Halos versus full load<a class="headerlink" href="#partial-loading-the-halos-versus-full-load" title="Permalink to this headline">¶</a></h2>
<p>By default, partial loading (i.e. &#8216;lazy loading&#8217;) is used when loading
simulation files.  This means that the command h=s.halos() does not
actually load halo information until needed.  Sometimes the simulation
snapshot or the halo _particles file is very large, and is not
desirable or possible to load everything into memory.  Hence, partial
loading can be very useful.  The _particles file is needed to find out
which particles belong to a particular halo.</p>
<p>In the following example only particles from a single halo are loaded:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pynbody</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">pynbody</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s">&#39;tipsyfilename&#39;</span><span class="p">)</span> <span class="c"># nothing gets loaded yet.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">h</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">halos</span><span class="p">(</span><span class="n">dummy</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="c"># loads properties, but skips the _particles file load.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">h</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="c"># `dummy&#39; halo - its properties are loaded, but not particle data.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">h2</span><span class="o">=</span><span class="n">h</span><span class="o">.</span><span class="n">load_copy</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c"># loads particle ids from _particles file for halo 2 only</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">h2</span><span class="o">.</span><span class="n">star</span><span class="p">[</span><span class="s">&#39;pos&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="c"># Mow that data is requested, the simulation snapshot read.</span>
</pre></div>
</div>
<p>Partial loading can be switched off as follows:</p>
<p>DESCRIBE HOW................</p>
</div>
<div class="section" id="halos-only-usage-if-no-simulation-snapshot-present-does-this-work">
<h2>Halos only usage (if no simulation snapshot present) - Does this work?)<a class="headerlink" href="#halos-only-usage-if-no-simulation-snapshot-present-does-this-work" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">=</span><span class="n">pynbody</span><span class="o">.</span><span class="n">new</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">properties</span>  <span class="c"># prints the default properties just loaded (can be changed by e.g. s.properties[&#39;h&#39;]=.73)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">_filename</span><span class="o">=</span><span class="s">&quot;simulation_snapshot_name_without_the_ahf_suffixes&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">h</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="n">halos</span><span class="p">()</span> <span class="c">## load the halos from the AHF files</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">h</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">properties</span> <span class="c">##  prints all &#39;properties&#39; of halo 1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">h</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="s">&#39;mass&#39;</span><span class="p">]</span>  <span class="c"># halo 1 mass</span>
</pre></div>
</div>
<p>This can be useful if one wants to analyze the halo catalog without needing any information about the simulation particles.</p>
</div>
<div class="section" id="write-halo-catalog-i-e-convert-ahf-outfiles-to-tipsy-format">
<h2>Write halo catalog (i.e. convert AHF outfiles to tipsy format)<a class="headerlink" href="#write-halo-catalog-i-e-convert-ahf-outfiles-to-tipsy-format" title="Permalink to this headline">¶</a></h2>
<p>Tipsy is a particle viewer.  A tipsy format file can be useful for
quick viewing in tipsy to check whether the AHF halo finder did
anything sensible. Write the (ahf) halo catalog to disk. Former idl
users might notice that this produces outfiles similar to &#8216;Alyson&#8217;s
idl script&#8217;.</p>
<p>The 3 written file types are:
1- .gtp (tipsy file with halos as star particles).
2- .grp (ascii halo id of every snapshot particle, 0 if none).
3- .stat ascii condensed version of AHF halos file).</p>
<p>This halo file set is compatible with the halo finder SKID.</p>
<p>tipsy and skid can be found at <a class="reference external" href="http://www-hpcc.astro.washington.edu/tools/">http://www-hpcc.astro.washington.edu/tools/</a>.</p>
<div class="section" id="extra-steps-required-if-ahf-was-run-as-mpi-parallel">
<h3>Extra steps required if AHF was run as MPI parallel:<a class="headerlink" href="#extra-steps-required-if-ahf-was-run-as-mpi-parallel" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If AHF was run using MPI (multiple processors) &#8211; Skip this if AHF was run in serial or OpenMP.  There will be a set of AHF output files (_halos, _particles...) for each MPI process.  A couple of short steps are required to make it concatenate the filesets together.  At this time, MPI AHF does not write any _substructure files and does not keep global halo IDs across domains, so it is not always desireable to use MPI AHF.</p>
</div>
<p>from the command prompt (example for a z=0 AHF output):</p>
<p>&gt; cat simfilename.00*z0.000.AHF_halos | cat &gt; simfilename.z0.000.AHF_halos</p>
<p>The  _particles files requires an extra step to sort out headers.  Get the total number of halos (= number lines in _halos file - 1 for header).  From the command prompt:</p>
<p>&gt; wc simfilename.z0.000.AHF_halos | gawk &#8216;{print $1-1}&#8217; &gt; simfilename.z0.000.AHF_particles</p>
<p>&gt; gawk &#8216;FNR &gt; 1&#8217; simfilename.ahf.0*.z0.000.AHF_particles &gt;&gt; simfilename.z0.000.AHF_particles</p>
<dl class="docutils">
<dt>&gt; cat simfilename.00*z0.000.AHF_profiles | cat &gt; simfilename.z0.000.AHF_profiles</dt>
<dd>#  the _profiles concatenation is optional.  Note MPI AHF produces no _substructure files.</dd>
</dl>
</div>
<div class="section" id="now-convert-to-tipsy-if-serial-openmp-ahf-or-after-above-file-concatenations-made-if-mpi">
<h3>Now convert to tipsy If serial/OpenMP AHF (or after above file concatenations made if MPI):<a class="headerlink" href="#now-convert-to-tipsy-if-serial-openmp-ahf-or-after-above-file-concatenations-made-if-mpi" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If AHF was run using MPI, first concatnate the AHF processor outfiles into a single outfile set, as described above.</p>
</div>
<p>In directory with AHF outputs, where there should be a _halos file, a _particles file, and a _substructure (if not run with MPI):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pynbody</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">=</span><span class="n">pynbody</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">simfile</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">h</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="n">halos</span><span class="p">(</span><span class="n">make_grp</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>  <span class="c"># _particles file is read now, not `partial loaded&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">h</span><span class="o">.</span><span class="n">writestat</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">h</span><span class="p">,</span><span class="n">simfile</span><span class="o">.</span><span class="n">stat</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">h</span><span class="o">.</span><span class="n">writetipsy</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">h</span><span class="p">,</span><span class="n">simfile</span><span class="o">.</span><span class="n">gtp</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="p">[</span><span class="s">&#39;grp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">write</span><span class="p">()</span> <span class="c"># writes &#39;simfile.grp&#39;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If a .grp file is not needed, it can be skipped by using s.halos() instead of s.halos(make_grp=True) (and then also skipping the s[&#8216;grp].write().  The reason to skip the _grp file creation is that for simulations with large particle numbers, the _particles file read through, which is triggered by s[&#8216;grp&#8217;].write() (with partial loading enabled), can be quite slow when the _particles file is large.</p>
</div>
<p>pynbody computes the &#8216;hubble&#8217; constant by default &#8211; specifying avoids rounding errors in converting halo positions, which might be important for some applications, as in:
&gt;&gt;&gt; h.writetipsy(s,h,&#8221;test.gtp&#8221;,hubble=0.7)
&gt;&gt;&gt; h.writestat(s,h,&#8221;test.stat&#8221;,hubble=0.7)</p>
<p>In the above example, we also override the default outfile name, which just adds an extension to the simulation file name.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The default AHF and pynbody expectation (as of 2012.04.17) is that TIPSY_PARTICLE_ORDERING (gas, dark, star) is NOT set in the AHF compilation, so pynbody expects non-tipsy default AHF particle ID ordering of dark, star, gas.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">AHF orders halos by particle number, which is not quite the same as ordering by halo mass if there are multiple particle masses.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">One a .grp file is written, there will now be both a _particles file and a .grp file in the directory.  By default, pynbody will try to load the .grp file.  _particles file loading can be forced by</p>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">h</span><span class="o">=</span><span class="n">pynbody</span><span class="o">.</span><span class="n">halo</span><span class="o">.</span><span class="n">AHFCatalogue</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="generating-catalogues-on-the-fly-with-pynbody">
<h2>Generating catalogues on the fly with pynbody<a class="headerlink" href="#generating-catalogues-on-the-fly-with-pynbody" title="Permalink to this headline">¶</a></h2>
<p>There is also a mechanism for running halo-finders on-the-fly with
pynbody from simulation snapshot. This is currently implemented by the
AHFCatalogue class which reads amiga halo catalogues.</p>
<p>The AHFCatalogue._can_load() looks for an AHF _particles file. If that
is not found and all the other _can_loads fail (&#8212;&#8212;&#8212;-WHAT OTHER FILES ATTEMPT TO LOAD?), pynbody searches your
executable PATH environment variable for AHFstep. If it finds that, it
creates the necessary input files and runs Amiga Halo Finder for
you. AHFstep doesn&#8217;t take that long (1 minute for 10 million
particles?). Once AHFstep finishes, the HaloCatalog loads the particle
file into Halo objects for each halo that are IndexedSubSnaps. Each
Halo has slightly extended properties that include all the values from
the AHF_halos file. The AHFCatalogue also loads the substructure file
into the [&#8216;children&#8217;] property.</p>
<div class="section" id="installing-ahfstep-for-pynbody-compatibility">
<h3>Installing AHFstep for pynbody compatibility<a class="headerlink" href="#installing-ahfstep-for-pynbody-compatibility" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">These are quite old instructions and may be out of date.</p>
</div>
<p>From the command prompt:</p>
<p>&gt;wget <a class="reference external" href="http://popia.ft.uam.es/AHF/files/ahf-v1.0.tgz">http://popia.ft.uam.es/AHF/files/ahf-v1.0.tgz</a></p>
<p>&gt;tar zxf ahf-v1.0.tgz</p>
<p>&gt;cd ahf-v1.0</p>
<p>Edit Makefile.config. For Tipsy, uncomment the DEFINEFLAGS line under MW1.1024g1bwk, g1536, GALFOBS. Possibly switch CC line to use icc (then -fopenmp becomes -openmp) and up the OPTIMIZE line to -O3</p>
<p>From command prompt:</p>
<p>&gt;make AHF</p>
<p>&gt;mkdir ~/bin/</p>
<p>&gt;cp bin/AHF* ~/bin/</p>
<p>&gt;export PATH=&#8221;$PATH:${HOME}/bin&#8221;</p>
<p>It is a good idea to put this last line above into your .bashrc file on Linux or .profile in Mac OS X.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Halos in Pynbody</a><ul>
<li><a class="reference internal" href="#working-with-halos-and-catalogues">Working with Halos and Catalogues</a></li>
<li><a class="reference internal" href="#partial-loading-the-halos-versus-full-load">Partial loading the Halos versus full load</a></li>
<li><a class="reference internal" href="#halos-only-usage-if-no-simulation-snapshot-present-does-this-work">Halos only usage (if no simulation snapshot present) - Does this work?)</a></li>
<li><a class="reference internal" href="#write-halo-catalog-i-e-convert-ahf-outfiles-to-tipsy-format">Write halo catalog (i.e. convert AHF outfiles to tipsy format)</a><ul>
<li><a class="reference internal" href="#extra-steps-required-if-ahf-was-run-as-mpi-parallel">Extra steps required if AHF was run as MPI parallel:</a></li>
<li><a class="reference internal" href="#now-convert-to-tipsy-if-serial-openmp-ahf-or-after-above-file-concatenations-made-if-mpi">Now convert to tipsy If serial/OpenMP AHF (or after above file concatenations made if MPI):</a></li>
</ul>
</li>
<li><a class="reference internal" href="#generating-catalogues-on-the-fly-with-pynbody">Generating catalogues on the fly with pynbody</a><ul>
<li><a class="reference internal" href="#installing-ahfstep-for-pynbody-compatibility">Installing AHFstep for pynbody compatibility</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="pictures.html"
                        title="previous chapter">Pictures in Pynbody</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="processing.html"
                        title="next chapter">Batch-processing Snapshots with Pynbody</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/tutorials/halos.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="processing.html" title="Batch-processing Snapshots with Pynbody"
             >next</a> |</li>
        <li class="right" >
          <a href="pictures.html" title="Pictures in Pynbody"
             >previous</a> |</li>
        <li><a href="../index.html">pynbody 0.18-alpha documentation</a> &raquo;</li>
          <li><a href="tutorials.html" >Pynbody Tutorials</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011-13, pynbody team &lt;http://code.google.com/p/pynbody/people/list&gt;).
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.1.
    </div>
  </body>
</html>