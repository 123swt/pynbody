<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Subviews and Filters &mdash; pynbody 0.30 documentation</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootswatch-3.1.0/spacelab/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.30',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.1.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="pynbody 0.30 documentation" href="../index.html" />
    <link rel="up" title="Pynbody Tutorials" href="tutorials.html" />
    <link rel="next" title="Tracing Particles between Snapshots" href="bridge.html" />
    <link rel="prev" title="A walk through pynbody’s low-level facilities" href="data_access.html" />

<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-38063425-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

  </head>
  <body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html">
          pynbody</a>
        <span class="navbar-text navbar-version pull-left"><b>0.30</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Sections <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="tutorials.html">Tutorials &amp; walkthroughs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">Reference</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Subviews and Filters</a><ul>
<li><a class="reference internal" href="#how-do-i-create-a-simple-subview">How do I create a simple subview?</a></li>
<li><a class="reference internal" href="#conceptually-everything-is-a-pointer">Conceptually, everything is a pointer</a></li>
<li><a class="reference internal" href="#filters">Filters</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="data_access.html" title="Previous Chapter: A walk through pynbody’s low-level facilities"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm">&laquo; A walk through p...</span>
    </a>
  </li>
  <li>
    <a href="bridge.html" title="Next Chapter: Tracing Particles between Snapshots"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm">Tracing Particle... &raquo;</span>
    </a>
  </li>
              
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12">
      
  <div class="section" id="subviews-and-filters">
<h1>Subviews and Filters<a class="headerlink" href="#subviews-and-filters" title="Permalink to this headline">¶</a></h1>
<p>Analyzing simulations often boils down to comparing properties of
groups of particles or sections of the simulated volume. Therefore a
generic task in analysis routines is to search for indices of
particles (or cells) corresponding to some interesting property, so
analysis code often looks something like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">index</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">sim</span><span class="p">[</span><span class="s">&quot;group&quot;</span><span class="p">]</span><span class="o">==</span><span class="n">group_id</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">sim</span><span class="p">[</span><span class="s">&quot;mass&quot;</span><span class="p">][</span><span class="n">index</span><span class="p">]</span><span class="o">*</span><span class="n">sim</span><span class="p">[</span><span class="s">&quot;pos&quot;</span><span class="p">][</span><span class="n">index</span><span class="p">])</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>In this example, we obtained the center of mass of some group
specified by <cite>group_id</cite>. Such patterns are fine, but they are ugly to
look at and illegible when written out in long complicated chains.</p>
<p>For this reason, <cite>pynbody</cite> has the concept of sub-views of
simulations. Subviews behave exactly like a full simulation, but they
reference only a subset of the data of that full simulation.</p>
<p>This makes writing code which processes individual halos trivial; for
instance</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">sim</span><span class="p">[</span><span class="s">&quot;mass&quot;</span><span class="p">]</span><span class="o">*</span><span class="n">sim</span><span class="p">[</span><span class="s">&quot;pos&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>will find the centre of mass of whatever you throw at it. So if we had
some way of defining a <em>sub-view</em> of the whole simulation that refers
to just the halo that we want, called <cite>halo</cite>, then we could do
something like</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">halo</span><span class="p">[</span><span class="s">&quot;mass&quot;</span><span class="p">]</span><span class="o">*</span><span class="n">halo</span><span class="p">[</span><span class="s">&quot;pos&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>The indexing is taken care of under the hood and all the boilerplate
indexing code is gone. In this tutorial, we discuss some of the ways
that subviews and filters can be used in <cite>pynbody</cite>.</p>
<div class="section" id="how-do-i-create-a-simple-subview">
<h2>How do I create a simple subview?<a class="headerlink" href="#how-do-i-create-a-simple-subview" title="Permalink to this headline">¶</a></h2>
<p>Quite simply, indexing or slicing operations commute with array-fetch
operations, i.e.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">subsim</span> <span class="o">=</span> <span class="n">sim</span><span class="p">[</span><span class="nb">slice</span><span class="p">]</span> <span class="c"># -&gt; new SimSnap object</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sim</span><span class="p">[</span><span class="nb">slice</span><span class="p">][</span><span class="s">&quot;x&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">sim</span><span class="p">[</span><span class="s">&quot;x&quot;</span><span class="p">][</span><span class="nb">slice</span><span class="p">]</span> <span class="c"># -&gt; True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">subsim</span><span class="p">[</span><span class="s">&quot;x&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">sim</span><span class="p">[</span><span class="s">&quot;x&quot;</span><span class="p">][</span><span class="nb">slice</span><span class="p">]</span> <span class="c"># -&gt; True</span>
</pre></div>
</div>
<p><cite>slice</cite> here can literally be a python slice (e.g. <cite>sim[22:73:2]</cite>,
starting at the 22nd particle, finishing at the 72nd, taking every
second particle). It can also be a list of particle indices.</p>
<p>Or, more interestingly, it can be a <cite>filter</cite>. More on that below, but first...</p>
</div>
<div class="section" id="conceptually-everything-is-a-pointer">
<h2>Conceptually, everything is a pointer<a class="headerlink" href="#conceptually-everything-is-a-pointer" title="Permalink to this headline">¶</a></h2>
<p>Whenever you create a sub-view of your simulation, you should think of
it as a _pointer_ into, not a copy of, the original data.</p>
<p>Thus changing anything in the arrays of your sub-view makes the
corresponding change in the full data.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">subsim</span><span class="p">[</span><span class="s">&#39;x&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">22</span>
</pre></div>
</div>
<p>You can verify that the corresponding element of <cite>sim[&#8216;x&#8217;]</cite> has now changed</p>
</div>
<div class="section" id="filters">
<h2>Filters<a class="headerlink" href="#filters" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="../reference/convenience.html#module-pynbody.filt" title="pynbody.filt"><tt class="xref py py-mod docutils literal"><span class="pre">pynbody.filt</span></tt></a> defines abstract filters which can be used in place of
index lists. For instance,</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">radius</span> <span class="o">=</span> <span class="s">&quot;1 kpc&quot;</span> <span class="c"># or might be a float if you already know your units</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">centre</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="c"># Take the origin for now</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sphere</span> <span class="o">=</span> <span class="n">sub</span><span class="p">[</span><span class="n">pynbody</span><span class="o">.</span><span class="n">filt</span><span class="o">.</span><span class="n">Sphere</span><span class="p">(</span><span class="n">radius</span><span class="p">,</span> <span class="n">centre</span><span class="p">)]</span>
</pre></div>
</div>
<p><cite>sphere</cite> is now a standard subsim, as though you&#8217;d generated it with
your own index list.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">sphere</span><span class="p">[</span><span class="s">&quot;mass&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="c"># -&gt; total mass in sphere</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sphere</span><span class="p">[</span><span class="s">&quot;pos&quot;</span><span class="p">]</span> <span class="c"># etc</span>
</pre></div>
</div>
<p>Under the hood, filters are very simple objects which have a
<cite>__call__</cite> method taking a simulation as the sole parameter, and
returning a boolean array representing whether particles are included
(<cite>True</cite>) or excluded (<cite>False</cite>) according to the given filter
object. The framework uses this to generate an index list and proceeds
as though you&#8217;d passed that index list in.</p>
<p>The benefits that this brings are:</p>
<blockquote>
<div><ul class="simple">
<li>Code clarity</li>
<li>Code factorization (guaranteed that the &#8216;sphere&#8217; filter works,
rather than having to recode a sphere index-list operation each
time)</li>
<li>Future extensibility (e.g. we can just start having Sphere&#8217;s
accept quantities with units, rather than having to reimplement to
include units in all code which pulls out spheres)</li>
<li>Parallelizability (the &#8216;filter&#8217; objects can be trivially sent to
another node, whereas an index list is irrelevant on another node)</li>
</ul>
</div></blockquote>
<p>Filters can be combined using the following operators, which can of course be chained together:</p>
<table border="1" class="docutils">
<colgroup>
<col width="22%" />
<col width="78%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Operator</strong></th>
<th class="head"><strong>Particle included if</strong></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><cite>f1 &amp; f2</cite></td>
<td>Filters <cite>f1</cite> and <cite>f2</cite> both include particle</td>
</tr>
<tr class="row-odd"><td><cite>f1 | f2</cite></td>
<td>Filter <cite>f1</cite> OR <cite>f2</cite> includes particle</td>
</tr>
<tr class="row-even"><td><cite>~f</cite></td>
<td>Filter <cite>f</cite> does NOT include particle</td>
</tr>
</tbody>
</table>
<p>There are several filter classes currently implemented. Generic filter
classes work like band-pass filters and are conveniently named so. For example,</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">young</span> <span class="o">=</span> <span class="n">pynbody</span><span class="o">.</span><span class="n">filt</span><span class="o">.</span><span class="n">LowPass</span><span class="p">(</span><span class="s">&#39;age&#39;</span><span class="p">,</span> <span class="s">&#39;1 Gyr&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">old</span> <span class="o">=</span> <span class="n">pynbody</span><span class="o">.</span><span class="n">filt</span><span class="o">.</span><span class="n">HighPass</span><span class="p">(</span><span class="s">&#39;age&#39;</span><span class="p">,</span> <span class="s">&#39;10 Gyr&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">intermediate</span> <span class="o">=</span> <span class="n">pynbody</span><span class="o">.</span><span class="n">filt</span><span class="o">.</span><span class="n">BandPass</span><span class="p">(</span><span class="s">&#39;age&#39;</span><span class="p">,</span> <span class="s">&#39;3 Gyr&#39;</span><span class="p">,</span> <span class="s">&#39;7 Gyr&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>would create three filters that each select particles with different
value ranges for the <cite>age</cite> array.</p>
<p>Additionaly, several &#8220;geometric&#8221; filter classes are available. We
already saw <a class="reference internal" href="../reference/convenience.html#pynbody.filt.Sphere" title="pynbody.filt.Sphere"><tt class="xref py py-class docutils literal"><span class="pre">Sphere</span></tt></a> used above, but
<a class="reference internal" href="../reference/convenience.html#pynbody.filt.Disc" title="pynbody.filt.Disc"><tt class="xref py py-class docutils literal"><span class="pre">Disc</span></tt></a>, <a class="reference internal" href="../reference/convenience.html#pynbody.filt.Cuboid" title="pynbody.filt.Cuboid"><tt class="xref py py-class docutils literal"><span class="pre">Cuboid</span></tt></a>, and two
convenience functions <a class="reference internal" href="../reference/convenience.html#pynbody.filt.SolarNeighborhood" title="pynbody.filt.SolarNeighborhood"><tt class="xref py py-func docutils literal"><span class="pre">SolarNeighborhood()</span></tt></a> and
<a class="reference internal" href="../reference/convenience.html#pynbody.filt.Annulus" title="pynbody.filt.Annulus"><tt class="xref py py-func docutils literal"><span class="pre">Annulus()</span></tt></a> are also available.</p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
<div id="sourcelink">
  <a href="../_sources/tutorials/filters.txt"
     rel="nofollow">Source</a>
</div>
      
    </p>
    <p>
        &copy; Copyright 2011-14, pynbody team https://github.com/pynbody/pynbody/graphs/contributors.<br/>
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2.2.<br/>
    </p>
  </div>
</footer>
  </body>
</html>