
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Batch-processing Snapshots with Pynbody &mdash; pynbody 0.18-alpha documentation</title>
    
    <link rel="stylesheet" href="../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.18-alpha',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="pynbody 0.18-alpha documentation" href="../index.html" />
    <link rel="up" title="Pynbody Tutorials" href="tutorials.html" />
    <link rel="next" title="Performance optimisation in pynbody" href="performance.html" />
    <link rel="prev" title="Halo loading in Pynbody" href="halos.html" />
 
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-38063425-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="performance.html" title="Performance optimisation in pynbody"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="halos.html" title="Halo loading in Pynbody"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">pynbody 0.18-alpha documentation</a> &raquo;</li>
          <li><a href="tutorials.html" accesskey="U">Pynbody Tutorials</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="batch-processing-snapshots-with-pynbody">
<h1>Batch-processing Snapshots with Pynbody<a class="headerlink" href="#batch-processing-snapshots-with-pynbody" title="Permalink to this headline">¶</a></h1>
<div class="section" id="using-pynbody-as-a-batch-system">
<h2>Using pynbody as a batch system<a class="headerlink" href="#using-pynbody-as-a-batch-system" title="Permalink to this headline">¶</a></h2>
<p>One typical use for scripting software like python is to automate common
tasks.  You can use <cite>pynbody</cite> to run a standard series of analysis
routines &#8211; for instance to produce small png files on the cluster where you&#8217;re running simulations.
That way, you can just download 1 MB of images rather than the
~1 GB snapshot files to find out how a simulation is progressing.</p>
<p>Going a step further, you might also create a <cite>.data</cite> file using the
python pickle module, giving fundamental properties of the
snapshot like the mass of stars, hot gas, cold gas, radial profiles, a
rotation curve.  That way, when you want to make future plots
comparing snapshots from different times or different parameter
choices, you only have to use pickle to quickly open the 50 kB data
file instead of opening the 1 GB snapshot file.</p>
</div>
<div class="section" id="doall-py">
<h2>doall.py<a class="headerlink" href="#doall-py" title="Permalink to this headline">¶</a></h2>
<p>There is an example script in pynbody/examples called doall.py that does
a lot of generic analysis of a cosmological galaxy simulation.  To go through
it piece by piece, let&#8217;s look at the four main sections: the <a class="reference internal" href="#dopreamble"><em>Preamble</em></a>
the part that
<a class="reference internal" href="#storesdata"><em>pickle data</em></a>, the part that <a class="reference internal" href="#standardplots"><em>make standard plots</em></a> and the part
that <a class="reference internal" href="#images"><em>make standard images</em></a>:</p>
<div class="section" id="preamble">
<span id="dopreamble"></span><h3>Preamble<a class="headerlink" href="#preamble" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pynbody</span>
<span class="kn">import</span> <span class="nn">pynbody.plot</span> <span class="kn">as</span> <span class="nn">pp</span>
<span class="kn">import</span> <span class="nn">pynbody.plot.sph</span>
<span class="kn">import</span> <span class="nn">pynbody.filt</span> <span class="kn">as</span> <span class="nn">filt</span>
<span class="kn">import</span> <span class="nn">pynbody.units</span> <span class="kn">as</span> <span class="nn">units</span>
<span class="kn">import</span> <span class="nn">pynbody.analysis.profile</span> <span class="kn">as</span> <span class="nn">profile</span>
<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">glob</span><span class="o">,</span> <span class="nn">pickle</span>

<span class="n">simname</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>   <span class="c"># use first argument as simulation name to analyze</span>
<span class="n">pp</span><span class="o">.</span><span class="n">plt</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>            <span class="c"># plot in interactive mode to show all plots as </span>
                        <span class="c">#     they are made</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">pynbody</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">simname</span><span class="p">)</span> <span class="c"># load file into pynbody</span>
<span class="n">h</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">halos</span><span class="p">()</span>             <span class="c"># find and load halos (using AHF if in path)</span>
<span class="n">diskf</span> <span class="o">=</span> <span class="n">filt</span><span class="o">.</span><span class="n">Disc</span><span class="p">(</span><span class="s">&#39;40 kpc&#39;</span><span class="p">,</span><span class="s">&#39;2 kpc&#39;</span><span class="p">)</span>  <span class="c"># filter for particles in disk</span>
<span class="n">notdiskf</span> <span class="o">=</span> <span class="n">filt</span><span class="o">.</span><span class="n">Not</span><span class="p">(</span><span class="n">filt</span><span class="o">.</span><span class="n">Disc</span><span class="p">(</span><span class="s">&#39;40 kpc&#39;</span><span class="p">,</span><span class="s">&#39;3 kpc&#39;</span><span class="p">))</span> <span class="c"># particles outside of disk</span>
<span class="n">i</span><span class="o">=</span><span class="mi">1</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">):</span>
    <span class="c"># if there&#39;s a second argument, it can be a photogenic file</span>
    <span class="c"># and analysis will follow the halo that contains those particles</span>
    <span class="n">photiords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">dtype</span><span class="o">=</span><span class="s">&#39;i8&#39;</span><span class="p">)</span>
    <span class="n">frac</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">in1d</span><span class="p">(</span><span class="n">photiords</span><span class="p">,</span><span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;iord&#39;</span><span class="p">]))[</span><span class="mi">0</span><span class="p">]))</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">photiords</span><span class="p">)</span>
    <span class="k">print</span> <span class="s">&#39;i: </span><span class="si">%d</span><span class="s"> frac: </span><span class="si">%.2f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">frac</span><span class="p">)</span>
    <span class="k">while</span><span class="p">(((</span><span class="n">frac</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">100</span><span class="p">)):</span> 
        <span class="n">i</span><span class="o">=</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span>
        <span class="n">frac</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">in1d</span><span class="p">(</span><span class="n">photiords</span><span class="p">,</span><span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;iord&#39;</span><span class="p">]))[</span><span class="mi">0</span><span class="p">]))</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">photiords</span><span class="p">)</span>
        <span class="k">print</span> <span class="s">&#39;i: </span><span class="si">%d</span><span class="s"> frac: </span><span class="si">%.2f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">frac</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="c"># otherwise follow largest halo with at least 2 stars</span>
    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">star</span><span class="p">)</span> <span class="o">&lt;</span><span class="mi">2</span><span class="p">:</span> <span class="n">i</span><span class="o">=</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span>

<span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="o">==</span><span class="mi">100</span><span class="p">):</span> <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
<span class="n">pynbody</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">angmom</span><span class="o">.</span><span class="n">faceon</span><span class="p">(</span><span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>  <span class="c"># align halo faceon</span>
<span class="n">s</span><span class="o">.</span><span class="n">physical_units</span><span class="p">()</span>   <span class="c"># change to physical units</span>
</pre></div>
</div>
<p>Most of the lines in the preamble are commented as to their purpose.  Overall,</p>
<ol class="arabic simple">
<li>The appropriate modules are loaded with the import statements</li>
<li>The simulation is loaded based on a command line argument</li>
<li>If a photogenic file (gasoline thing) is given, the halo that includes those particle ids is loaded.</li>
<li>The halo is rotated so the disk is face-on</li>
</ol>
</div>
<div class="section" id="pickle-data">
<span id="storesdata"></span><h3>pickle data<a class="headerlink" href="#pickle-data" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Jtot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(((</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;j&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span><span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;mass&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>            <span class="c"># calculate angular momentum</span>
<span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;phi&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;mass&#39;</span><span class="p">])</span> <span class="c"># halo potential energy</span>
<span class="n">K</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;ke&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;mass&#39;</span><span class="p">])</span>  <span class="c"># halo kinetic energy</span>
<span class="n">absE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">W</span><span class="o">+</span><span class="n">K</span><span class="p">)</span>    <span class="c"># total halo energy</span>
<span class="n">mvir</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;mass&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">in_units</span><span class="p">(</span><span class="s">&#39;Msol&#39;</span><span class="p">))</span>  <span class="c"># virial mass</span>
<span class="n">rvir</span><span class="o">=</span><span class="n">pynbody</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">SimArray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;r&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">in_units</span><span class="p">(</span><span class="s">&#39;kpc&#39;</span><span class="p">)),</span><span class="s">&#39;kpc&#39;</span><span class="p">)</span>
<span class="c"># 3D density profile</span>
<span class="n">rhoprof</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">Profile</span><span class="p">(</span><span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">dim</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="nb">type</span><span class="o">=</span><span class="s">&#39;log&#39;</span><span class="p">)</span>
<span class="c"># Rotation curve</span>
<span class="n">rcpro</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">Profile</span><span class="p">(</span><span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="nb">type</span><span class="o">=</span><span class="s">&#39;equaln&#39;</span><span class="p">,</span> <span class="n">nbins</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span> <span class="nb">max</span> <span class="o">=</span> <span class="s">&#39;40 kpc&#39;</span><span class="p">)</span>
<span class="c"># surface brightness profile</span>
<span class="n">diskstars</span> <span class="o">=</span> <span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">star</span><span class="p">[</span><span class="n">filt</span><span class="o">.</span><span class="n">Disc</span><span class="p">(</span><span class="s">&#39;20 kpc&#39;</span><span class="p">,</span><span class="s">&#39;3 kpc&#39;</span><span class="p">)]</span>
<span class="n">sbprof</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">Profile</span><span class="p">(</span><span class="n">diskstars</span><span class="p">,</span><span class="nb">type</span><span class="o">=</span><span class="s">&#39;equaln&#39;</span><span class="p">)</span>
<span class="c"># Kinematic decomposition</span>
<span class="c">#decompprof = pynbody.analysis.decomp(h[i])</span>
<span class="c">#dec = h[i].star[&#39;decomp&#39;]</span>

<span class="c">### Save important numbers using pickle.  </span>
<span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">({</span><span class="s">&#39;z&#39;</span><span class="p">:</span><span class="n">s</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="s">&#39;z&#39;</span><span class="p">],</span>
             <span class="s">&#39;time&#39;</span><span class="p">:</span><span class="n">s</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="s">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">in_units</span><span class="p">(</span><span class="s">&#39;Gyr&#39;</span><span class="p">),</span>
             <span class="s">&#39;rvir&#39;</span><span class="p">:</span><span class="n">rvir</span><span class="p">,</span>
             <span class="s">&#39;mvir&#39;</span><span class="p">:</span><span class="n">mvir</span><span class="p">,</span>
             <span class="s">&#39;mgas&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">gas</span><span class="p">[</span><span class="s">&#39;mass&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">in_units</span><span class="p">(</span><span class="s">&#39;Msol&#39;</span><span class="p">)),</span>
             <span class="s">&#39;mstar&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">star</span><span class="p">[</span><span class="s">&#39;mass&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">in_units</span><span class="p">(</span><span class="s">&#39;Msol&#39;</span><span class="p">)),</span>
<span class="c">#             &#39;mdisk&#39;: np.sum(h[i].star[np.where(dec == 1)][&#39;mass&#39;].in_units(&#39;Msol&#39;)),</span>
<span class="c">#             &#39;msphere&#39;: np.sum(h[i].star[np.where(dec == 2)][&#39;mass&#39;].in_units(&#39;Msol&#39;)),</span>
<span class="c">#             &#39;mbulge&#39;: np.sum(h[i].star[np.where(dec == 3)][&#39;mass&#39;].in_units(&#39;Msol&#39;)),</span>
<span class="c">#             &#39;mthick&#39;: np.sum(h[i].star[np.where(dec == 4)][&#39;mass&#39;].in_units(&#39;Msol&#39;)),</span>
<span class="c">#             &#39;mpseudob&#39;: np.sum(h[i].star[np.where(dec == 5)][&#39;mass&#39;].in_units(&#39;Msol&#39;)),</span>
             <span class="s">&#39;mgashot&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">gas</span><span class="p">[</span><span class="n">filt</span><span class="o">.</span><span class="n">HighPass</span><span class="p">(</span><span class="s">&#39;temp&#39;</span><span class="p">,</span><span class="mf">1e5</span><span class="p">)][</span><span class="s">&#39;mass&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">in_units</span><span class="p">(</span><span class="s">&#39;Msol&#39;</span><span class="p">)),</span>
             <span class="s">&#39;mgascool&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">gas</span><span class="p">[</span><span class="n">filt</span><span class="o">.</span><span class="n">LowPass</span><span class="p">(</span><span class="s">&#39;temp&#39;</span><span class="p">,</span><span class="mf">1e5</span><span class="p">)][</span><span class="s">&#39;mass&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">in_units</span><span class="p">(</span><span class="s">&#39;Msol&#39;</span><span class="p">)),</span>
             <span class="s">&#39;Jtot&#39;</span><span class="p">:</span><span class="n">Jtot</span><span class="p">,</span><span class="s">&#39;lambda&#39;</span><span class="p">:(</span><span class="n">Jtot</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">mvir</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">rvir</span><span class="o">*</span><span class="n">units</span><span class="o">.</span><span class="n">G</span><span class="p">))</span><span class="o">.</span><span class="n">in_units</span><span class="p">(</span><span class="s">&#39;1&#39;</span><span class="p">),</span>
             <span class="s">&#39;denprof&#39;</span><span class="p">:{</span><span class="s">&#39;r&#39;</span><span class="p">:</span><span class="n">rhoprof</span><span class="p">[</span><span class="s">&#39;rbins&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">in_units</span><span class="p">(</span><span class="s">&#39;kpc&#39;</span><span class="p">),</span> 
                        <span class="s">&#39;den&#39;</span><span class="p">:</span><span class="n">rhoprof</span><span class="p">[</span><span class="s">&#39;density&#39;</span><span class="p">]},</span>
             <span class="s">&#39;rotcur&#39;</span><span class="p">:{</span><span class="s">&#39;r&#39;</span><span class="p">:</span><span class="n">rcpro</span><span class="p">[</span><span class="s">&#39;rbins&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">in_units</span><span class="p">(</span><span class="s">&#39;kpc&#39;</span><span class="p">),</span> 
                       <span class="s">&#39;vc&#39;</span><span class="p">:</span><span class="n">rcpro</span><span class="p">[</span><span class="s">&#39;rotation_curve_spherical&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">in_units</span><span class="p">(</span><span class="s">&#39;km s^-1&#39;</span><span class="p">),</span>
                       <span class="s">&#39;fourier&#39;</span><span class="p">:</span><span class="n">rcpro</span><span class="p">[</span><span class="s">&#39;fourier&#39;</span><span class="p">]},</span>
             <span class="s">&#39;sb&#39;</span><span class="p">:{</span><span class="s">&#39;r&#39;</span><span class="p">:</span><span class="n">sbprof</span><span class="p">[</span><span class="s">&#39;rbins&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">in_units</span><span class="p">(</span><span class="s">&#39;kpc&#39;</span><span class="p">),</span> 
                   <span class="s">&#39;sb&#39;</span><span class="p">:</span><span class="n">sbprof</span><span class="p">[</span><span class="s">&#39;sb,i&#39;</span><span class="p">]}</span>
             <span class="p">},</span>
            <span class="nb">open</span><span class="p">(</span><span class="n">simname</span><span class="o">+</span><span class="s">&#39;.data&#39;</span><span class="p">,</span><span class="s">&#39;w&#39;</span><span class="p">),</span> <span class="n">pickle</span><span class="o">.</span><span class="n">HIGHEST_PROTOCOL</span><span class="p">)</span>
</pre></div>
</div>
<ol class="arabic simple">
<li>Some special pieces of data about the halo are calculated for storage.</li>
<li>The data is saved using the python pickle module (pickle.dump)</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The kinematic decomposition section is commented out because it is
a little slow.</p>
</div>
<ul class="simple">
<li>The pickled data can be used to make comparisons as in the following
code</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">pynbody</span><span class="o">,</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">pickle</span><span class="o">,</span> <span class="nn">glob</span><span class="o">,</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="n">runs</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;c.1td.05rp.1&#39;</span><span class="p">,</span><span class="s">&#39;mugs&#39;</span><span class="p">,</span><span class="s">&#39;esn1.2&#39;</span><span class="p">,</span><span class="s">&#39;td.01c.1rp.1&#39;</span><span class="p">,</span><span class="s">&#39;rp.175&#39;</span><span class="p">,</span><span class="s">&#39;noradpres&#39;</span><span class="p">,</span><span class="s">&#39;2crasy&#39;</span><span class="p">]</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;Fiducial&#39;</span><span class="p">,</span><span class="s">&#39;MUGS&#39;</span><span class="p">,</span><span class="s">&#39;120% SN energy&#39;</span><span class="p">,</span><span class="s">&#39;Low Diffusion&#39;</span><span class="p">,</span><span class="s">&#39;High Diffusion&#39;</span><span class="p">,</span><span class="s">&#39;No ESF&#39;</span><span class="p">,</span>
          <span class="s">&#39;High ESF&#39;</span><span class="p">]</span>
<span class="n">cs</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;r&#39;</span><span class="p">,</span><span class="s">&#39;k&#39;</span><span class="p">,</span><span class="s">&#39;c&#39;</span><span class="p">,</span><span class="s">&#39;g&#39;</span><span class="p">,</span><span class="s">&#39;y&#39;</span><span class="p">,</span><span class="s">&#39;m&#39;</span><span class="p">,</span><span class="s">&#39;b&#39;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">j</span><span class="p">,</span><span class="n">r</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">runs</span><span class="p">):</span>
    <span class="n">simname</span><span class="o">=</span><span class="n">r</span><span class="o">+</span><span class="s">&#39;/01024/g1536.01024&#39;</span>

    <span class="n">d</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">simname</span><span class="o">+</span><span class="s">&#39;.data&#39;</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">j</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s">&#39;rotcur&#39;</span><span class="p">][</span><span class="s">&#39;r&#39;</span><span class="p">],</span><span class="n">d</span><span class="p">[</span><span class="s">&#39;rotcur&#39;</span><span class="p">][</span><span class="s">&#39;vc&#39;</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="n">cs</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> 
                 <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">labels</span><span class="p">[</span><span class="n">j</span><span class="p">],</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">j</span><span class="o">==</span><span class="mi">6</span><span class="p">:</span>
            <span class="n">rad</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s">&#39;rotcur&#39;</span><span class="p">][</span><span class="s">&#39;r&#39;</span><span class="p">]</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rad</span><span class="p">,(</span><span class="mf">2.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s">&#39;rotcur&#39;</span><span class="p">][</span><span class="s">&#39;vc&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">rad</span><span class="p">),</span>
                     <span class="s">&#39;--b&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s">&#39;arctangent fit&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s">&#39;rotcur&#39;</span><span class="p">][</span><span class="s">&#39;r&#39;</span><span class="p">],</span><span class="n">d</span><span class="p">[</span><span class="s">&#39;rotcur&#39;</span><span class="p">][</span><span class="s">&#39;vc&#39;</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="n">cs</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> 
                 <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">labels</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
        <span class="n">rad</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s">&#39;rotcur&#39;</span><span class="p">][</span><span class="s">&#39;r&#39;</span><span class="p">]</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rad</span><span class="p">,(</span><span class="mf">2.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s">&#39;rotcur&#39;</span><span class="p">][</span><span class="s">&#39;vc&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">rad</span><span class="p">),</span>
                 <span class="s">&#39;--r&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s">&#39;arctangent fit&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">&#39;rc.eps&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="make-standard-plots">
<span id="standardplots"></span><h3>make standard plots<a class="headerlink" href="#make-standard-plots" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre><span class="c">### Make plots</span>
<span class="k">try</span><span class="p">:</span>
	<span class="n">pp</span><span class="o">.</span><span class="n">sbprofile</span><span class="p">(</span><span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">filename</span><span class="o">=</span><span class="n">simname</span><span class="o">+</span><span class="s">&#39;.sbprof.png&#39;</span><span class="p">,</span><span class="n">center</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
	<span class="n">pp</span><span class="o">.</span><span class="n">sfh</span><span class="p">(</span><span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">filename</span><span class="o">=</span><span class="n">simname</span><span class="o">+</span><span class="s">&#39;.sfh.png&#39;</span><span class="p">,</span><span class="n">nbins</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
	<span class="n">pp</span><span class="o">.</span><span class="n">rotation_curve</span><span class="p">(</span><span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">filename</span><span class="o">=</span><span class="n">simname</span><span class="o">+</span><span class="s">&#39;.rc.png&#39;</span><span class="p">,</span><span class="n">quick</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
					  <span class="nb">max</span><span class="o">=</span><span class="s">&#39;40 kpc&#39;</span><span class="p">,</span><span class="n">center</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
	<span class="n">pp</span><span class="o">.</span><span class="n">rotation_curve</span><span class="p">(</span><span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">filename</span><span class="o">=</span><span class="n">simname</span><span class="o">+</span><span class="s">&#39;.rcparts.png&#39;</span><span class="p">,</span><span class="n">quick</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                          <span class="n">parts</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="s">&#39;40 kpc&#39;</span><span class="p">,</span><span class="n">center</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
	<span class="n">pp</span><span class="o">.</span><span class="n">rho_T</span><span class="p">(</span><span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">filename</span><span class="o">=</span><span class="n">simname</span><span class="o">+</span><span class="s">&#39;.phase.png&#39;</span><span class="p">)</span>
	<span class="n">pp</span><span class="o">.</span><span class="n">ofefeh</span><span class="p">(</span><span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">stars</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">simname</span><span class="o">+</span><span class="s">&#39;.ofefeh.png&#39;</span><span class="p">,</span>
                  <span class="n">weights</span><span class="o">=</span><span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">stars</span><span class="p">[</span><span class="s">&#39;mass&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">in_units</span><span class="p">(</span><span class="s">&#39;Msol&#39;</span><span class="p">),</span> <span class="n">scalemin</span><span class="o">=</span><span class="mf">1e3</span><span class="p">,</span>
                  <span class="n">scalemax</span><span class="o">=</span><span class="mf">1e6</span><span class="p">,</span> <span class="n">x_range</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mf">0.3</span><span class="p">],</span><span class="n">y_range</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">1.0</span><span class="p">])</span>
	<span class="n">pp</span><span class="o">.</span><span class="n">mdf</span><span class="p">(</span><span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">stars</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="n">simname</span><span class="o">+</span><span class="s">&#39;.mdf.png&#39;</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="mf">0.5</span><span class="p">])</span>
	<span class="n">pp</span><span class="o">.</span><span class="n">density_profile</span><span class="p">(</span><span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">dark</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="n">simname</span><span class="o">+</span><span class="s">&#39;.dmprof.png&#39;</span><span class="p">,</span><span class="n">center</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
	<span class="n">pp</span><span class="o">.</span><span class="n">guo</span><span class="p">(</span><span class="n">h</span><span class="p">,</span><span class="n">baryfrac</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="n">simname</span><span class="o">+</span><span class="s">&#39;.guo.png&#39;</span><span class="p">)</span>
	<span class="n">pp</span><span class="o">.</span><span class="n">schmidtlaw</span><span class="p">(</span><span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">filename</span><span class="o">=</span><span class="n">simname</span><span class="o">+</span><span class="s">&#39;.schmidt.png&#39;</span><span class="p">,</span><span class="n">center</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
	<span class="n">pp</span><span class="o">.</span><span class="n">satlf</span><span class="p">(</span><span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">filename</span><span class="o">=</span><span class="n">simname</span><span class="o">+</span><span class="s">&#39;.satlf.png&#39;</span><span class="p">)</span>
<span class="k">except</span><span class="p">:</span>
	<span class="k">pass</span>
</pre></div>
</div>
<ul class="simple">
<li>Inside of a <tt class="docutils literal"><span class="pre">try:</span> <span class="pre">except:</span></tt> statement, a series of standard plots are created.  Because of the <tt class="docutils literal"><span class="pre">try:</span> <span class="pre">except:</span> <span class="pre">pass</span></tt>, if any of them fails, the script will continue.</li>
<li>For each of these procedures, the filename argument lets you save the plot as the given filename.</li>
<li>In some of the plots, fixed axis ranges are given so that quick movies can be made by putting all the image frames together.</li>
</ul>
</div>
<div class="section" id="make-standard-images">
<span id="images"></span><h3>make standard images<a class="headerlink" href="#make-standard-images" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre><span class="n">diskgas</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="n">gas</span><span class="p">[</span><span class="n">diskf</span><span class="p">]</span>
<span class="c">### Make pictures: </span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">pp</span><span class="o">.</span><span class="n">sph</span><span class="o">.</span><span class="n">image</span><span class="p">(</span><span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">gas</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="n">simname</span><span class="o">+</span><span class="s">&#39;.facegas.png&#39;</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
    <span class="n">pp</span><span class="o">.</span><span class="n">sph</span><span class="o">.</span><span class="n">image</span><span class="p">(</span><span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">star</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="n">simname</span><span class="o">+</span><span class="s">&#39;.facestar.png&#39;</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
    <span class="n">pp</span><span class="o">.</span><span class="n">sph</span><span class="o">.</span><span class="n">image</span><span class="p">(</span><span class="n">diskgas</span><span class="p">,</span><span class="n">qty</span><span class="o">=</span><span class="s">&#39;temp&#39;</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="n">simname</span><span class="o">+</span><span class="s">&#39;.tempgasdiskface.png&#39;</span><span class="p">,</span>
                 <span class="n">width</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span><span class="n">vmin</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">gas</span><span class="p">[</span><span class="s">&#39;hiden&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">gas</span><span class="p">[</span><span class="s">&#39;rho&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">s</span><span class="o">.</span><span class="n">gas</span><span class="p">[</span><span class="s">&#39;HI&#39;</span><span class="p">]</span>
    <span class="n">s</span><span class="o">.</span><span class="n">gas</span><span class="p">[</span><span class="s">&#39;hiden&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">gas</span><span class="p">[</span><span class="s">&#39;rho&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">units</span>
    <span class="n">pynbody</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">image</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">gas</span><span class="p">,</span><span class="n">qty</span><span class="o">=</span><span class="s">&#39;hiden&#39;</span><span class="p">,</span><span class="n">units</span><span class="o">=</span><span class="s">&#39;m_p cm^-2&#39;</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
                       <span class="n">center</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="n">simname</span><span class="o">+</span><span class="s">&#39;.hi500kpc.png&#39;</span><span class="p">,</span>
                       <span class="n">vmin</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mi">22</span><span class="p">)</span>
    <span class="n">pynbody</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">image</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">gas</span><span class="p">,</span><span class="n">qty</span><span class="o">=</span><span class="s">&#39;hiden&#39;</span><span class="p">,</span><span class="n">units</span><span class="o">=</span><span class="s">&#39;m_p cm^-2&#39;</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
                       <span class="n">center</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="n">simname</span><span class="o">+</span><span class="s">&#39;.hi250kpc.png&#39;</span><span class="p">,</span>
                       <span class="n">vmin</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mi">22</span><span class="p">)</span>
    <span class="n">oviif</span> <span class="o">=</span> <span class="n">pynbody</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">ionfrac</span><span class="o">.</span><span class="n">calculate</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">gas</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">gas</span><span class="p">[</span><span class="s">&#39;oviden&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">gas</span><span class="p">[</span><span class="s">&#39;rho&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">s</span><span class="o">.</span><span class="n">gas</span><span class="p">[</span><span class="s">&#39;OxMassFrac&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">oviif</span>
    <span class="n">s</span><span class="o">.</span><span class="n">gas</span><span class="p">[</span><span class="s">&#39;oviden&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">gas</span><span class="p">[</span><span class="s">&#39;rho&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">units</span>
    <span class="n">soviim</span> <span class="o">=</span> <span class="n">pynbody</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">image</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">gas</span><span class="p">[</span><span class="n">notdiskf</span><span class="p">],</span><span class="n">qty</span><span class="o">=</span><span class="s">&#39;oviden&#39;</span><span class="p">,</span>
                                <span class="n">units</span><span class="o">=</span><span class="s">&#39;16 m_p cm^-2&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
                                <span class="n">filename</span><span class="o">=</span><span class="n">simname</span><span class="o">+</span><span class="s">&#39;.ovi500kpc.png&#39;</span><span class="p">,</span>
                                <span class="n">vmin</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">gas</span><span class="p">[</span><span class="s">&#39;oxden&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">gas</span><span class="p">[</span><span class="s">&#39;rho&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">s</span><span class="o">.</span><span class="n">gas</span><span class="p">[</span><span class="s">&#39;OxMassFrac&#39;</span><span class="p">]</span>
    <span class="n">s</span><span class="o">.</span><span class="n">gas</span><span class="p">[</span><span class="s">&#39;oxden&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">gas</span><span class="p">[</span><span class="s">&#39;rho&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">units</span>
    <span class="n">pynbody</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">image</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">gas</span><span class="p">,</span><span class="n">qty</span><span class="o">=</span><span class="s">&#39;oxden&#39;</span><span class="p">,</span><span class="n">units</span><span class="o">=</span><span class="s">&#39;16 m_p cm^-2&#39;</span><span class="p">,</span>
                       <span class="n">width</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span><span class="n">center</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                       <span class="n">filename</span><span class="o">=</span><span class="n">simname</span><span class="o">+</span><span class="s">&#39;.ox500kpc.png&#39;</span><span class="p">,</span><span class="n">vmin</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
    <span class="n">pynbody</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">angmom</span><span class="o">.</span><span class="n">sideon</span><span class="p">(</span><span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">pp</span><span class="o">.</span><span class="n">sph</span><span class="o">.</span><span class="n">image</span><span class="p">(</span><span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">gas</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="n">simname</span><span class="o">+</span><span class="s">&#39;.sidegas.png&#39;</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
    <span class="n">pp</span><span class="o">.</span><span class="n">sph</span><span class="o">.</span><span class="n">image</span><span class="p">(</span><span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">star</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="n">simname</span><span class="o">+</span><span class="s">&#39;.sidestar.png&#39;</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
    <span class="n">pp</span><span class="o">.</span><span class="n">sph</span><span class="o">.</span><span class="n">image</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">gas</span><span class="p">,</span><span class="n">qty</span><span class="o">=</span><span class="s">&#39;temp&#39;</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="n">simname</span><span class="o">+</span><span class="s">&#39;.tempgasside.png&#39;</span><span class="p">,</span>
                 <span class="n">width</span><span class="o">=</span><span class="mi">320</span><span class="p">,</span><span class="n">vmin</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
    <span class="n">pp</span><span class="o">.</span><span class="n">sph</span><span class="o">.</span><span class="n">image</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">gas</span><span class="p">,</span><span class="n">qty</span><span class="o">=</span><span class="s">&#39;temp&#39;</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="n">simname</span><span class="o">+</span><span class="s">&#39;.tempgasdiskside.png&#39;</span><span class="p">,</span>
                 <span class="n">width</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span><span class="n">vmin</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
    <span class="n">pynbody</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">image</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">gas</span><span class="p">,</span><span class="n">qty</span><span class="o">=</span><span class="s">&#39;temp&#39;</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span><span class="n">center</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                       <span class="n">filename</span><span class="o">=</span><span class="n">simname</span><span class="o">+</span><span class="s">&#39;.temp500kpc.png&#39;</span><span class="p">,</span><span class="n">vmin</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">pass</span>
</pre></div>
</div>
<ul class="simple">
<li>The images are similar to the plots in that they get saved to the filename argument.</li>
<li>One difference is that the images require a width to say how much of the simulation they should include.</li>
<li>vmin and vmax represent the dynamic range of the image.</li>
<li>A couple of auxillary quantities are calculated like the enrichment of a certain ion species.</li>
</ul>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Batch-processing Snapshots with Pynbody</a><ul>
<li><a class="reference internal" href="#using-pynbody-as-a-batch-system">Using pynbody as a batch system</a></li>
<li><a class="reference internal" href="#doall-py">doall.py</a><ul>
<li><a class="reference internal" href="#preamble">Preamble</a></li>
<li><a class="reference internal" href="#pickle-data">pickle data</a></li>
<li><a class="reference internal" href="#make-standard-plots">make standard plots</a></li>
<li><a class="reference internal" href="#make-standard-images">make standard images</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="halos.html"
                        title="previous chapter">Halo loading in Pynbody</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="performance.html"
                        title="next chapter">Performance optimisation in pynbody</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/tutorials/processing.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="performance.html" title="Performance optimisation in pynbody"
             >next</a> |</li>
        <li class="right" >
          <a href="halos.html" title="Halo loading in Pynbody"
             >previous</a> |</li>
        <li><a href="../index.html">pynbody 0.18-alpha documentation</a> &raquo;</li>
          <li><a href="tutorials.html" >Pynbody Tutorials</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011-13, pynbody team &lt;http://code.google.com/p/pynbody/people/list&gt;).
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>